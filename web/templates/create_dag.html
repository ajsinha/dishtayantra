{% extends "base.html" %}

{% block title %}Create DAG - {{ app_name }} Compute Server{% endblock %}

{% block content %}
<div class="row mb-3">
    <div class="col-md-12">
        <a href="{{ url_for('dashboard') }}" class="btn btn-secondary mb-3">
            <i class="bi bi-arrow-left"></i> Back to Dashboard
        </a>
        <h2><i class="bi bi-plus-circle"></i> Create New DAG</h2>
        <p class="text-muted">Upload a JSON configuration file to create a new DAG</p>
    </div>
</div>

<div class="row">
    <div class="col-md-8 offset-md-2">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5><i class="bi bi-file-earmark-code"></i> DAG Configuration</h5>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('create_dag') }}" enctype="multipart/form-data">
                    <div class="mb-4">
                        <label for="config_file" class="form-label">
                            <strong>Configuration File (JSON)</strong>
                        </label>
                        <input type="file" class="form-control form-control-lg" id="config_file" name="config_file" accept=".json" required>
                        <div class="form-text">
                            <i class="bi bi-info-circle"></i> Select a JSON file containing the DAG configuration
                        </div>
                    </div>

                    <div class="alert alert-info">
                        <h6 class="alert-heading"><i class="bi bi-lightbulb"></i> Configuration Requirements</h6>
                        <ul class="mb-0">
                            <li>File must be valid JSON format</li>
                            <li>Must include: name, subscribers, publishers, nodes, edges</li>
                            <li>Optional: start_time, end_time (HHMM format)</li>
                            <li>DAG name must be unique and alphanumeric with underscores</li>
                        </ul>
                    </div>

                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i class="bi bi-upload"></i> Create DAG
                        </button>
                        <a href="{{ url_for('dashboard') }}" class="btn btn-outline-secondary">
                            <i class="bi bi-x-circle"></i> Cancel
                        </a>
                    </div>
                </form>
            </div>
        </div>

        <div class="card mt-4">
            <div class="card-header">
                <h6><i class="bi bi-code-square"></i> Example Configuration</h6>
            </div>
            <div class="card-body">
                <pre class="bg-light p-3" style="font-size: 12px; max-height: 400px; overflow-y: auto;"><code>{
  "name": "my_data_pipeline",
  "start_time": "0900",
  "end_time": "1700",
  "subscribers": [
    {
      "name": "input_sub",
      "config": {
        "source": "mem://queue/input_queue",
        "max_depth": 1000
      }
    }
  ],
  "publishers": [
    {
      "name": "output_pub",
      "config": {
        "destination": "mem://queue/output_queue"
      }
    }
  ],
  "calculators": [
    {
      "name": "my_calc",
      "type": "ApplyDefaultsCalculator",
      "config": {
        "defaults": {"status": "processed"}
      }
    }
  ],
  "transformers": [],
  "nodes": [
    {
      "name": "input_node",
      "type": "SubscriptionNode",
      "config": {},
      "subscriber": "input_sub"
    },
    {
      "name": "calc_node",
      "type": "CalculationNode",
      "config": {},
      "calculator": "my_calc"
    },
    {
      "name": "output_node",
      "type": "PublicationNode",
      "config": {},
      "publishers": ["output_pub"]
    }
  ],
  "edges": [
    {
      "from_node": "input_node",
      "to_node": "calc_node"
    },
    {
      "from_node": "calc_node",
      "to_node": "output_node"
    }
  ]
}</code></pre>
            </div>
        </div>
    </div>
</div>
{% endblock %}